<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BETBOX - מעקב ליינים והזדמנויות הימור</title>
    <style>
        :root {
            --primary-bg: #181818;
            --secondary-bg: #222;
            --header-bg: #333;
            --text-color: #fff;
            --text-muted: #aaa;
            --border-color: #444;
            --green-color: #4caf50;
            --blue-color: #2196f3;
            --yellow-color: #ffc107;
            --red-color: #f44336;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: var(--primary-bg);
            color: var(--text-color);
            direction: rtl;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
        }
        
        header {
            background-color: var(--header-bg);
            padding: 15px 0;
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .header-title {
            font-size: 24px;
            font-weight: bold;
        }
        
        .header-date {
            font-size: 14px;
            color: var(--text-muted);
            margin-top: 5px;
        }
        
        .filters {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .filter-group {
            background-color: var(--secondary-bg);
            padding: 10px;
            border-radius: 5px;
            flex: 1;
            margin: 0 5px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-muted);
            font-size: 12px;
        }
        
        .filter-group select, 
        .filter-group input {
            width: 100%;
            padding: 8px;
            background-color: var(--primary-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-radius: 3px;
        }
        
        .games-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .games-table th,
        .games-table td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }
        
        .games-table th {
            background-color: var(--header-bg);
            color: var(--text-muted);
            font-weight: normal;
            font-size: 14px;
        }
        
        .games-table tbody tr {
            background-color: var(--secondary-bg);
        }
        
        .games-table tbody tr:hover {
            background-color: #2a2a2a;
        }
        
        .games-table .date,
        .games-table .time,
        .games-table .league {
            color: var(--yellow-color);
        }
        
        .spread,
        .total {
            color: var(--text-color);
            font-weight: bold;
        }
        
        .live-value {
            color: var(--green-color);
            font-weight: bold;
        }
        
        .negative-value {
            color: var(--red-color);
        }
        
        .green-row {
            border-right: 4px solid var(--green-color);
        }
        
        .blue-row {
            border-right: 4px solid var(--blue-color);
        }
        
        .refresh-info {
            margin: 15px 0;
            font-size: 12px;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
        }
        
        .refresh-controls {
            display: flex;
            align-items: center;
        }
        
        .refresh-controls label {
            margin-right: 10px;
        }
        
        .refresh-controls select {
            background-color: var(--secondary-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 5px;
            border-radius: 3px;
        }
        
        .button {
            background-color: var(--header-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .button:hover {
            background-color: #444;
        }
        
        /* מצב לייב */
        .status-live {
            color: var(--red-color);
            font-weight: bold;
        }
        
        /* התאמה למובייל */
        @media (max-width: 768px) {
            .filters {
                flex-direction: column;
            }
            
            .filter-group {
                margin: 5px 0;
            }
            
            .games-table th,
            .games-table td {
                padding: 8px 4px;
                font-size: 12px;
            }
            
            .games-table .hide-mobile {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-title">BETBOX</div>
            <div class="header-date" id="current-date"></div>
        </div>
    </header>
    
    <div class="container">
        <div class="filters">
            <div class="filter-group">
                <label>ספורט</label>
                <select id="sport-filter">
                    <option value="all">הכל</option>
                    <option value="18">כדורסל</option>
                    <option value="1">כדורגל</option>
                </select>
            </div>
            <div class="filter-group">
                <label>סטטוס</label>
                <select id="status-filter">
                    <option value="all">הכל</option>
                    <option value="upcoming">משחקים קרובים</option>
                    <option value="live">משחקים חיים</option>
                </select>
            </div>
            <div class="filter-group">
                <label>ליגה</label>
                <select id="league-filter">
                    <option value="all">הכל</option>
                </select>
            </div>
            <div class="filter-group">
                <label>הזדמנויות</label>
                <select id="opportunity-filter">
                    <option value="all">הכל</option>
                    <option value="green">ירוק - ביטחון גבוה</option>
                    <option value="blue">כחול - מצבי</option>
                </select>
            </div>
        </div>
        
        <div class="refresh-info">
            <div id="last-update">עדכון אחרון: --:--</div>
            <div class="refresh-controls">
                <label>רענון אוטומטי:</label>
                <select id="auto-refresh">
                    <option value="10">כל 10 שניות</option>
                    <option value="30" selected>כל 30 שניות</option>
                    <option value="60">כל דקה</option>
                </select>
                <button class="button" id="refresh-button">רענן עכשיו</button>
            </div>
        </div>
        
        <table class="games-table">
            <thead>
                <tr>
                    <th>תאריך</th>
                    <th>שעה</th>
                    <th>ליגה</th>
                    <th>משחק</th>
                    <th>ספרד</th>
                    <th>O/U</th>
                    <th class="hide-mobile">ליין נוכחי</th>
                    <th>ליין התחלה</th>
                    <th>ליין לייב</th>
                    <th>O/U לייב</th>
                </tr>
            </thead>
            <tbody id="games-tbody">
                <!-- תוכן הטבלה ימולא דרך JavaScript -->
            </tbody>
        </table>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // עדכון התאריך הנוכחי
            updateCurrentDate();
            
            // אתחול הרענון האוטומטי
            const autoRefreshSelect = document.getElementById('auto-refresh');
            let refreshInterval;
            
            function setAutoRefresh() {
                clearInterval(refreshInterval);
                const seconds = parseInt(autoRefreshSelect.value);
                refreshInterval = setInterval(fetchGames, seconds * 1000);
            }
            
            autoRefreshSelect.addEventListener('change', setAutoRefresh);
            
            // אתחול פילטרים
            const sportFilter = document.getElementById('sport-filter');
            const statusFilter = document.getElementById('status-filter');
            const leagueFilter = document.getElementById('league-filter');
            const opportunityFilter = document.getElementById('opportunity-filter');
            
            sportFilter.addEventListener('change', fetchGames);
            statusFilter.addEventListener('change', fetchGames);
            leagueFilter.addEventListener('change', applyFilters);
            opportunityFilter.addEventListener('change', applyFilters);
            
            // כפתור רענון ידני
            document.getElementById('refresh-button').addEventListener('click', fetchGames);
            
            // משתנים גלובליים
            let allGames = [];
            
            // פונקציה לעדכון התאריך
            function updateCurrentDate() {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('current-date').textContent = now.toLocaleDateString('he-IL', options);
            }
            
            // פונקציה להבאת המשחקים מהשרת
            function fetchGames() {
                const sport = sportFilter.value;
                const status = statusFilter.value;
                
                let url = `/api/games?sport_id=${sport}`;
                if (status !== 'all') {
                    url += `&status=${status}`;
                }
                
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        allGames = data;
                        updateLeagueOptions();
                        applyFilters();
                        updateLastUpdateTime();
                    })
                    .catch(error => {
                        console.error('Error fetching games:', error);
                    });
            }
            
            // פונקציה לעדכון אפשרויות הליגה בפילטר
            function updateLeagueOptions() {
                const leagues = new Set();
                allGames.forEach(game => leagues.add(game.league));
                
                const currentLeague = leagueFilter.value;
                leagueFilter.innerHTML = '<option value="all">הכל</option>';
                
                leagues.forEach(league => {
                    const option = document.createElement('option');
                    option.value = league;
                    option.textContent = league;
                    leagueFilter.appendChild(option);
                });
                
                if (Array.from(leagues).includes(currentLeague)) {
                    leagueFilter.value = currentLeague;
                }
            }
            
            // פונקציה לסינון המשחקים לפי הפילטרים
            function applyFilters() {
                const selectedLeague = leagueFilter.value;
                const selectedOpportunity = opportunityFilter.value;
                
                let filteredGames = [...allGames];
                
                if (selectedLeague !== 'all') {
                    filteredGames = filteredGames.filter(game => game.league === selectedLeague);
                }
